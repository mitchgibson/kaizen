# Kaizen Plugin â€” Codebase Index\n\nComplete guide to the plugin's source code structure and modules.\n\n## Quick Navigation\n\n- **User Documentation**: [`../KAIZEN_README.md`](../KAIZEN_README.md)\n- **Quick Start**: [`./QUICKSTART.md`](./QUICKSTART.md)\n- **Implementation Details**: [`./IMPLEMENTATION_COMPLETE.md`](./IMPLEMENTATION_COMPLETE.md)\n- **Original Spec**: [`./implementation-plan.md`](./implementation-plan.md)\n\n## Source Files\n\n### Core Layers\n\n#### Domain Layer: `src/domain/habit.ts` (142 lines)\n\n**Purpose**: Pure business logic for habit calculations.\n\n**Exports**:\n- `type ISODate = string` â€” Date format (YYYY-MM-DD)\n- `interface Habit` â€” Core habit model\n- `todayISO()` â€” Get today's date\n- `deriveCount(h)` â€” Calculate count from history\n- `markDone(habit, date?)` â€” Idempotent completion marking\n- `currentStreak(habit, now?)` â€” Current consecutive days\n- `longestStreak(habit)` â€” Best streak ever\n- `isDoneToday(habit, now?)` â€” Check today's completion\n- `completionRate(habit, pastDays, now?)` â€” N-day completion %\n\n**Key Properties**:\n- âœ… Zero Obsidian API usage (pure functions)\n- âœ… Fully testable\n- âœ… Deterministic date handling\n\n---\n\n#### Repository Adapter: `src/adapters/repo/habitRepo.ts` (181 lines)\n\n**Purpose**: File I/O and YAML frontmatter handling.\n\n**Exports**:\n- `createHabitRepo(app: App)` â€” Factory function\n- Returns object with methods:\n  - `findAllHabits(tagOrField?)` â€” Discover all habits\n  - `readFile(path)` â€” Read file content\n  - `writeHabit(habit)` â€” Persist habit (merge-safe)\n  - `createHabitFile(filename, habit)` â€” Create new habit file\n  - `getHabitById(id)` â€” Fetch single habit\n- `type HabitRepo` â€” Type alias for returned object\n\n**Key Properties**:\n- âœ… YAML frontmatter parsing and generation\n- âœ… Safe read-before-write pattern\n- âœ… Error handling for missing files\n- âœ… Metadata cache integration\n\n---\n\n#### Service Layer: `src/services/habitService.ts` (123 lines)\n\n**Purpose**: Orchestrate domain + repository logic.\n\n**Exports**:\n- `interface ServiceOptions` â€” Configuration\n- `createHabitService(repo, opts)` â€” Factory function\n- Returns object with methods:\n  - `listHabits()` â€” Get all habits\n  - `getHabit(id)` â€” Get single habit\n  - `increment(habit, date?)` â€” Mark complete\n  - `createHabit(filename, title, trigger?, schedule?)` â€” Create habit\n- `type HabitService` â€” Type alias\n\n**Key Properties**:\n- âœ… Optional daily note logging\n- âœ… Non-blocking error handling\n- âœ… Auto-creates Daily folder\n\n---\n\n### UI Layer\n\n#### Sidebar View: `src/ui/sidebarView.ts` (126 lines)\n\n**Purpose**: Compact sidebar with quick habit access.\n\n**Exports**:\n- `const VIEW_TYPE_SIDEBAR = 'kaizen-sidebar'`\n- `createSidebarView(habitService)` â€” Returns ItemView class\n\n**Features**:\n- Lists all habits with title, count, streak\n- âœ… button to mark done\n- ðŸ“ button to open note\n- Empty state when no habits\n- Auto-refresh after marking done\n\n---\n\n#### Full Page View: `src/ui/fullPageView.ts` (176 lines)\n\n**Purpose**: Detailed analytics dashboard.\n\n**Exports**:\n- `const VIEW_TYPE_FULL = 'kaizen-full'`\n- `createFullPageView(habitService)` â€” Returns ItemView class\n\n**Features**:\n- Habit cards with stats grid (Total, Streak, Best, 30-day %)\n- Status indicator (Done Today / Not Done)\n- Mark Done button\n- Recent 14-day history\n- Open note link\n- Responsive design\n\n---\n\n### Settings Layer\n\n#### Settings Config: `src/settings/settings.ts` (17 lines)\n\n**Purpose**: Settings interface and defaults.\n\n**Exports**:\n- `interface KaizenSettings` â€” Config type\n  - `autoLogToDailyNote: boolean`\n  - `deriveCountFromHistory: boolean`\n  - `habitField: string`\n  - `devLoggingEnabled: boolean`\n- `const DEFAULT_SETTINGS: KaizenSettings`\n\n---\n\n#### Settings Tab: `src/settings/settingsTab.ts` (103 lines)\n\n**Purpose**: Settings UI in Obsidian.\n\n**Exports**:\n- `class KaizenSettingsTab extends PluginSettingTab`\n\n**Features**:\n- Toggle controls for all settings\n- Descriptive help text\n- Habit format documentation\n- Clean, organized layout\n\n---\n\n### Plugin Entry Point\n\n#### Main Plugin: `src/main.ts` (200 lines)\n\n**Purpose**: Plugin bootstrap and wiring.\n\n**Exports**:\n- `export default class KaizenPlugin extends Plugin`\n\n**Methods**:\n- `async onload()` â€” Initialize on plugin load\n  - Load settings\n  - Create repo and service\n  - Register ribbon icon\n  - Register views\n  - Register commands\n  - Register settings tab\n- `onunload()` â€” Cleanup on unload\n- `loadSettings()` â€” Load persisted settings\n- `saveSettings()` â€” Persist settings\n- `promptForHabitName()` â€” Create habit dialog\n\n**Commands**:\n- `kaizen-open-sidebar` â€” Open sidebar view\n- `kaizen-open-full` â€” Open analytics view\n- `kaizen-create-habit` â€” Create new habit\n\n---\n\n## File Dependency Graph\n\n```\nmain.ts (Plugin)\n  â”œâ”€â†’ createHabitRepo() â†’ habitRepo.ts (Repository)\n  â”‚                         â””â”€â†’ domain/habit.ts (Domain)\n  â”‚\n  â”œâ”€â†’ createHabitService() â†’ habitService.ts (Service)\n  â”‚                           â”œâ”€â†’ habitRepo.ts\n  â”‚                           â””â”€â†’ domain/habit.ts\n  â”‚\n  â”œâ”€â†’ createSidebarView() â†’ sidebarView.ts (UI)\n  â”‚                         â””â”€â†’ habitService.ts (via closure)\n  â”‚\n  â”œâ”€â†’ createFullPageView() â†’ fullPageView.ts (UI)\n  â”‚                          â””â”€â†’ habitService.ts (via closure)\n  â”‚\n  â”œâ”€â†’ KaizenSettingsTab â†’ settingsTab.ts (Settings UI)\n  â”‚                       â””â”€â†’ settings.ts\n  â”‚\n  â””â”€â†’ settings.ts (Settings Config)\n```\n\n## Total Code Statistics\n\n| Module | Lines | Functions | Type | Purpose |\n|--------|-------|-----------|------|----------|\n| Domain | 142 | 7 | Pure | Business logic |\n| Repository | 181 | 6 | I/O | File persistence |\n| Service | 123 | 4 | Orchestration | App logic |\n| Sidebar UI | 126 | 2 | UI | Quick access view |\n| Full UI | 176 | 2 | UI | Analytics view |\n| Settings Config | 17 | 0 | Config | Settings interface |\n| Settings Tab | 103 | 1 | UI | Settings UI |\n| Main Plugin | 200 | 7 | Lifecycle | Plugin bootstrap |\n| **TOTAL** | **868** | **29** | **Mixed** | **Complete Plugin** |\n\n## Module Patterns\n\n### Factory Functions\n\nAll main modules use closure-style factories:\n\n```typescript\nexport const createXxx = (dependencies) => {\n  // Private implementation\n  function privateHelper() { }\n  \n  // Public API\n  return {\n    publicMethod1,\n    publicMethod2,\n  };\n};\n```\n\n**Benefits**:\n- Dependency injection\n- Encapsulation\n- Easy to test with mocks\n\n### Domain-Driven Design\n\n```\nDomain (Pure, testable)\n  â†‘\nRepository (I/O adapter)\n  â†‘\nService (Orchestration)\n  â†‘\nUI (Views and interactions)\n```\n\n## Key Abstractions\n\n### Habit Model\n\n```typescript\ninterface Habit {\n  id: string;           // file path\n  title: string;\n  trigger?: string;     // what triggers it\n  schedule?: string;    // how often\n  history: ISODate[];   // completion dates\n  count?: number;       // total count\n}\n```\n\n### ISO Date Format\n\n```typescript\ntype ISODate = string;  // YYYY-MM-DD (local time)\n```\n\n### Streak Calculation\n\nTracks consecutive days counting backwards from today:\n\n```\nHistory: [2025-01-01, 2025-01-02, 2025-01-03, 2025-01-05]\nToday: 2025-01-06\n\nStreak calculation:\n  2025-01-06: âœ— (not in history)\n  Result: 0 streak\n\nIf today was 2025-01-05:\n  2025-01-05: âœ“ (day 0)\n  2025-01-04: âœ— (gap)\n  Result: 1 streak\n```\n\n## View Types\n\n### Sidebar View (`kaizen-sidebar`)\n\n- **Type**: `ItemView`\n- **Display**: Compact row per habit\n- **Actions**: Mark done, open note\n- **Refresh**: After each action\n\n### Full Page View (`kaizen-full`)\n\n- **Type**: `ItemView`\n- **Display**: Detailed cards per habit\n- **Stats**: Total, streak, best, 30-day %\n- **History**: Last 14 days\n\n## Settings Storage\n\nSettings stored in:\n```\n.obsidian/plugins/obsidian-kaizen-habits/data.json\n```\n\nLoaded on plugin load, saved on each change.\n\n## Error Handling\n\nStrategy:\n\n1. **Repository**: Throws on critical errors (file not found)\n2. **Service**: Catches and logs, continues on optional features\n3. **UI**: Catches and shows user-friendly messages\n4. **Plugin**: Logs to console if dev logging enabled\n\n## Testing Strategy\n\n### Domain Functions (Pure)\n\n```typescript\nimport { markDone, currentStreak } from './domain/habit';\n\nconst h = { id: '1', title: 'X', history: ['2025-01-01'] };\nconst h2 = markDone(h, '2025-01-02');\nassert(currentStreak(h2) === 2);\n```\n\n### Repository (Mock App)\n\n```typescript\nconst mockApp = { vault: {...}, metadataCache: {...} };\nconst repo = createHabitRepo(mockApp);\nawait repo.writeHabit(habit);\n```\n\n### Service (Fake Repo)\n\n```typescript\nconst fakeRepo = { findAllHabits: () => [...] };\nconst service = createHabitService(fakeRepo, opts);\nconst habits = await service.listHabits();\n```\n\n## Performance Considerations\n\n1. **File Discovery**: O(n) where n = markdown files\n   - No caching (could optimize in v0.2)\n   - Happens on each sidebar open\n\n2. **History Analysis**: O(m) where m = history entries\n   - Reasonable for typical habits (< 1000 entries)\n   - Streak calculation efficient\n\n3. **DOM Rendering**: O(n) where n = habits\n   - Sidebar: Fast (renders once per open)\n   - Full view: Fast (renders once per open)\n\n## Future Optimization Points\n\n1. **Habit caching**: Cache in memory during session\n2. **Lazy loading**: Load full details on demand\n3. **Batch operations**: Mark multiple done at once\n4. **Streaming**: Large history handling\n5. **Debouncing**: Rapid UI updates\n\n## Development Workflow\n\n1. Edit source files in `src/`\n2. Run `npm run dev` (watch mode)\n3. Reload Obsidian (`Cmd+R` / `Ctrl+Shift+R`)\n4. Test in sidebar/analytics view\n5. Repeat\n\n## Publishing Checklist\n\n- [ ] Increment `manifest.json` version\n- [ ] Update `CHANGELOG` in `KAIZEN_README.md`\n- [ ] Run `npm run build`\n- [ ] Test with fresh Obsidian install\n- [ ] Create GitHub release\n- [ ] Add to Obsidian community registry\n\n## Resources\n\n- [Obsidian Sample Plugin](https://github.com/obsidianmd/obsidian-sample-plugin)\n- [Obsidian API Docs](https://docs.obsidian.md/)\n- [YAML.js Documentation](https://github.com/nodeca/js-yaml)\n- [TypeScript Handbook](https://www.typescriptlang.org/docs/)\n\n---\n\n**Happy coding! ðŸŽ‰**\n"